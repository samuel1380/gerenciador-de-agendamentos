<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Estilo - Manicure</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container pb-5">
        <div class="p-4">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <button onclick="history.back()" class="btn-outline"
                    style="width: auto; padding: 0.5rem 1rem; border:none; box-shadow:none;">
                    <span style="font-size: 1.2rem;">‚Üê</span>
                </button>
                <span style="font-size: 0.9rem; color: var(--text-light); font-weight: 600;">Quiz de Estilo</span>
                <div style="width: 24px;"></div> <!-- Spacer -->
            </div>

            <!-- Progress Bar -->
            <div class="quiz-progress">
                <div class="quiz-progress-bar" id="progressBar"></div>
            </div>

            <div id="quizContainer" class="quiz-container">
                <div id="questionBox" style="flex: 1; display: flex; flex-direction: column; justify-content: center;">
                    <h2 id="questionText" class="quiz-question-title">Pergunta...</h2>
                    <div id="optionsList">
                        <!-- Options injected here -->
                    </div>
                </div>
            </div>

            <div id="resultBox" class="hidden text-center result-card-anim" style="padding-top: 2rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">‚ú®</div>
                <h1 style="font-size: 2rem;">Seu Match!</h1>
                <p class="text-light mb-4">Baseado nas suas escolhas, seu estilo ideal √©:</p>

                <div class="card"
                    style="background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; margin-bottom: 2rem; border: none; padding: 2rem;">
                    <h2 id="resultTitle" style="color: white; font-size: 2rem; margin-bottom: 0.5rem;">Estilo X</h2>
                    <p id="resultDesc" style="font-size: 1.1rem; opacity: 0.9;">Descri√ß√£o do estilo...</p>
                </div>

                <button onclick="saveAndRedirect()" class="btn"
                    style="font-size: 1.1rem; padding: 1.25rem; box-shadow: 0 10px 25px rgba(224, 141, 157, 0.4);">
                    Agendar Servi√ßo Recomendado
                </button>
                <button onclick="location.reload()" class="btn-outline"
                    style="margin-top: 1rem; border: 2px solid var(--text-light); color: var(--text); padding: 1rem; font-weight: 600; border-radius: var(--radius); width: 100%; transition: all 0.3s ease;">
                    ‚Üª Refazer Quiz
                </button>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/theme.js"></script>
    <script>
        // Quiz Data for All Themes
        const quizData = {
            nail: {
                title: "Quiz de Estilo - Manicure",
                questions: [
                    {
                        text: "Qual sua cor favorita para unhas?",
                        options: [
                            { text: "Nude, Ros√™ ou Branco Transparente", score: 1 },
                            { text: "Vermelho, Vinho ou Preto", score: 2 },
                            { text: "Neon, Glitter ou Multicolorido", score: 3 },
                            { text: "Tons Past√©is (Lavanda, Menta, Beb√™)", score: 2 }
                        ]
                    },
                    {
                        text: "Qual tamanho de unha voc√™ costuma usar?",
                        options: [
                            { text: "Curta e Pr√°tica", score: 1 },
                            { text: "M√©dia (passando a ponta do dedo)", score: 2 },
                            { text: "Longa e Poderosa", score: 3 },
                            { text: "Extra Longa (Stiletto/Bailarina)", score: 3 }
                        ]
                    },
                    {
                        text: "Qual formato voc√™ prefere?",
                        options: [
                            { text: "Quadrada ou Quadrada com cantos arredondados", score: 1 },
                            { text: "Redonda ou Oval", score: 1 },
                            { text: "Almond (Amendoada)", score: 2 },
                            { text: "Stiletto ou Bailarina", score: 3 }
                        ]
                    },
                    {
                        text: "Como √© a sua rotina di√°ria?",
                        options: [
                            { text: "Muitas tarefas manuais", score: 1 },
                            { text: "Equilibrada", score: 2 },
                            { text: "Tranquila, evito impactos", score: 3 }
                        ]
                    },
                    {
                        text: "O que voc√™ acha de Nail Art?",
                        options: [
                            { text: "Prefiro sem nada", score: 1 },
                            { text: "Uma filha √∫nica", score: 2 },
                            { text: "Pedrarias simples", score: 3 },
                            { text: "Desenhos elaborados!", score: 4 }
                        ]
                    }
                ],
                getResult: (score) => {
                    if (score <= 6) return { title: "Cl√°ssica & Elegante", desc: "Tons discretos e atemporais. Recomendamos a Manicure Tradicional." };
                    if (score <= 11) return { title: "Moderna & Chic", desc: "Gosta de moda sem exageros. Recomendamos Esmalta√ß√£o em Gel." };
                    return { title: "Ousada & Criativa", desc: "Voc√™ adora chamar aten√ß√£o! Recomendamos Alongamento de Fibra." };
                }
            },
            barber: {
                title: "Quiz de Estilo - Barbearia",
                questions: [
                    {
                        text: "Qual √© o seu estilo de barba atual?",
                        options: [
                            { text: "Cara limpa (sem barba)", score: 1 },
                            { text: "Barba por fazer / rala", score: 2 },
                            { text: "Barba cheia / lenhador", score: 3 },
                            { text: "Bigode ou Cavanhaque", score: 3 }
                        ]
                    },
                    {
                        text: "Como voc√™ prefere o corte de cabelo?",
                        options: [
                            { text: "Militar / M√°quina total", score: 1 },
                            { text: "Degrad√™ (Fade) na r√©gua", score: 3 },
                            { text: "Cl√°ssico com tesoura", score: 2 },
                            { text: "Longo / Surfista", score: 2 }
                        ]
                    },
                    {
                        text: "Voc√™ usa produtos para cabelo/barba?",
                        options: [
                            { text: "N√£o, s√≥ shampoo b√°sico", score: 1 },
                            { text: "√Äs vezes uma pomada", score: 2 },
                            { text: "Sim, √≥leo, balm e pomada sempre", score: 3 }
                        ]
                    },
                    {
                        text: "Qual impress√£o voc√™ quer passar?",
                        options: [
                            { text: "S√©rio e Profissional", score: 1 },
                            { text: "Estiloso e Moderno", score: 3 },
                            { text: "Despojado e Natural", score: 2 }
                        ]
                    }
                ],
                getResult: (score) => {
                    if (score <= 5) return { title: "Visual Executivo", desc: "Corte pr√°tico e alinhado. Recomendamos Corte Cl√°ssico + Barba Simples." };
                    if (score <= 8) return { title: "Estilo Casual", desc: "Visual natural mas bem cuidado. Recomendamos Corte na Tesoura." };
                    return { title: "Visual Moderno", desc: "Degrad√™s e acabamento impec√°vel. Recomendamos Corte Fade + Barboterapia." };
                }
            },
            hair: {
                title: "Diagn√≥stico Capilar - Sal√£o Gold",
                questions: [
                    {
                        text: "Qual o comprimento do seu cabelo?",
                        options: [
                            { text: "Curto (acima do ombro)", score: 1 },
                            { text: "M√©dio (no ombro)", score: 2 },
                            { text: "Longo (no meio das costas)", score: 3 },
                            { text: "Extra longo", score: 3 }
                        ]
                    },
                    {
                        text: "O que mais te incomoda hoje?",
                        options: [
                            { text: "Frizz e volume excessivo", score: 3 },
                            { text: "Pontas duplas e ressecamento", score: 2 },
                            { text: "Cor desbotada / Raiz crescida", score: 2 },
                            { text: "Falta de corte / Sem formato", score: 1 }
                        ]
                    },
                    {
                        text: "Voc√™ tem qu√≠mica nos fios?",
                        options: [
                            { text: "Cabelo virgem (natural)", score: 1 },
                            { text: "Apenas colora√ß√£o/mechas", score: 2 },
                            { text: "Alisamento/Progressiva", score: 3 },
                            { text: "Colora√ß√£o e Alisamento", score: 4 }
                        ]
                    },
                    {
                        text: "Qual seu objetivo principal?",
                        options: [
                            { text: "Mudar radicalmente a cor", score: 3 },
                            { text: "Hidratar e recuperar a sa√∫de", score: 2 },
                            { text: "Apenas cortar as pontinhas", score: 1 }
                        ]
                    }
                ],
                getResult: (score) => {
                    if (score <= 5) return { title: "Renova√ß√£o Leve", desc: "Manuten√ß√£o necess√°ria. Recomendamos Corte Bordado + Nutri√ß√£o." };
                    if (score <= 9) return { title: "Tratamento Profundo", desc: "Seus fios precisam de vida. Recomendamos Cronograma Capilar ou Botox." };
                    return { title: "Transforma√ß√£o Total", desc: "Hora de mudar! Recomendamos Mechas ou Colora√ß√£o Global." };
                }
            },
            spa: {
                title: "Quiz de Bem-Estar - Spa",
                questions: [
                    {
                        text: "Qual seu n√≠vel de estresse hoje? (1-10)",
                        options: [
                            { text: "Baixo (1-3) - S√≥ quero relaxar", score: 1 },
                            { text: "M√©dio (4-7) - Cansada da rotina", score: 2 },
                            { text: "Alto (8-10) - Preciso de socorro!", score: 3 }
                        ]
                    },
                    {
                        text: "Onde voc√™ sente mais tens√£o?",
                        options: [
                            { text: "P√©s e Perna", score: 1 },
                            { text: "Pesco√ßo e Ombros", score: 2 },
                            { text: "Costas inteira (Lombar)", score: 2 },
                            { text: "Corpo todo / Mente cheia", score: 3 }
                        ]
                    },
                    {
                        text: "Qual tipo de toque voc√™ prefere?",
                        options: [
                            { text: "Toque leve e suave", score: 1 },
                            { text: "Press√£o m√©dia", score: 2 },
                            { text: "Toque firme e profundo", score: 3 }
                        ]
                    },
                    {
                        text: "Qual seu objetivo?",
                        options: [
                            { text: "Est√©tica (Reduzir medidas)", score: 1 },
                            { text: "Relaxamento profundo", score: 3 },
                            { text: "Dores musculares", score: 2 }
                        ]
                    }
                ],
                getResult: (score) => {
                    if (score <= 5) return { title: "Momento Zen", desc: "Para relaxar a mente. Recomendamos Massagem Relaxante com Aromaterapia." };
                    if (score <= 8) return { title: "Al√≠vio Muscular", desc: "Foco nas tens√µes. Recomendamos Massagem Deep Tissue ou Pedras Quentes." };
                    return { title: "Detox Total", desc: "Renova√ß√£o completa. Recomendamos o Ritual Day Spa (3h)." };
                }
            },
            tattoo: {
                title: "Consultoria Tattoo - Est√∫dio",
                questions: [
                    {
                        text: "√â a sua primeira tatuagem?",
                        options: [
                            { text: "Sim, √© a primeira", score: 1 },
                            { text: "Tenho algumas pequenas", score: 2 },
                            { text: "J√° sou tela viva (v√°rias)", score: 3 }
                        ]
                    },
                    {
                        text: "Qual estilo voc√™ curte?",
                        options: [
                            { text: "Tra√ßos finos (Fine line) / Escrita", score: 1 },
                            { text: "Old School / Tradicional", score: 2 },
                            { text: "Realismo / Blackwork pesado", score: 3 }
                        ]
                    },
                    {
                        text: "Qual tamanho voc√™ imagina?",
                        options: [
                            { text: "Pequena (at√© 7cm)", score: 1 },
                            { text: "M√©dia (palma da m√£o)", score: 2 },
                            { text: "Grande (fechamento)", score: 3 }
                        ]
                    },
                    {
                        text: "Local do corpo?",
                        options: [
                            { text: "Bra√ßo / Antebra√ßo", score: 1 },
                            { text: "Costela / Pesco√ßo (√°reas sens√≠veis)", score: 3 },
                            { text: "Perna / Coxa", score: 1 }
                        ]
                    }
                ],
                getResult: (score) => {
                    if (score <= 5) return { title: "Tattoo Delicada", desc: "Ideal para come√ßar. Recomendamos Flash Tattoo ou Fine Line minimalista." };
                    if (score <= 8) return { title: "Projeto Personalizado", desc: "Arte exclusiva. Recomendamos agendar cria√ß√£o de arte Sketch/Blackwork." };
                    return { title: "Projeto Grande", desc: "Para quem aguenta! Recomendamos sess√£o de Fechamento ou Realismo." };
                }
            },
            health: {
                title: "Pr√©-Avalia√ß√£o - Sa√∫de",
                questions: [
                    {
                        text: "Qual o motivo da consulta?",
                        options: [
                            { text: "Check-up de rotina", score: 1 },
                            { text: "Dor ou desconforto espec√≠fico", score: 3 },
                            { text: "Procedimento est√©tico", score: 2 }
                        ]
                    },
                    {
                        text: "H√° quanto tempo sente necessidade?",
                        options: [
                            { text: "Poucos dias / Decidi agora", score: 1 },
                            { text: "Algumas semanas", score: 2 },
                            { text: "Meses / Cr√¥nico", score: 3 }
                        ]
                    },
                    {
                        text: "Qual sua disponibilidade?",
                        options: [
                            { text: "Hor√°rio comercial", score: 1 },
                            { text: "In√≠cio da manh√£", score: 2 },
                            { text: "Final do dia/Noite", score: 2 }
                        ]
                    }
                ],
                getResult: (score) => {
                    if (score <= 4) return { title: "Consulta de Rotina", desc: "Preven√ß√£o √© o melhor rem√©dio. Agende um Check-up Geral." };
                    if (score <= 7) return { title: "Avalia√ß√£o Est√©tica", desc: "Vamos cuidar de voc√™. Agende uma Avalia√ß√£o Facial/Corporal." };
                    return { title: "Atendimento Priorit√°rio", desc: "N√£o adie sua sa√∫de. Recomendamos agendar o hor√°rio mais pr√≥ximo." };
                }
            }
        };

        const activeTheme = localStorage.getItem('client_theme') || 'nail';
        const currentData = quizData[activeTheme] || quizData['nail'];
        const questions = currentData.questions;

        // Set Title
        document.title = currentData.title;
        const pageTitle = document.querySelector('.p-4 span');
        if (pageTitle) pageTitle.textContent = currentData.title;

        let currentQ = 0;
        let totalScore = 0;
        let answers = [];

        function updateProgress() {
            const pct = ((currentQ + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = `${pct}%`;
        }

        function renderQuestion() {
            updateProgress();
            const q = questions[currentQ];

            // Fade out effect
            const container = document.getElementById('quizContainer');
            container.style.opacity = '0';

            setTimeout(() => {
                document.getElementById('questionText').textContent = q.text;
                const opts = document.getElementById('optionsList');
                opts.innerHTML = '';

                q.options.forEach(opt => {
                    const div = document.createElement('div');
                    div.className = 'quiz-option';
                    div.textContent = opt.text;
                    div.onclick = () => selectOption(opt);
                    opts.appendChild(div);
                });
                container.style.opacity = '1';
            }, 200);
        }

        function selectOption(opt) {
            totalScore += opt.score;
            answers.push(opt.text);
            currentQ++;
            if (currentQ < questions.length) {
                renderQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            document.getElementById('quizContainer').classList.add('hidden');
            document.querySelector('.quiz-progress').classList.add('hidden');
            const resBox = document.getElementById('resultBox');
            resBox.classList.remove('hidden');

            const result = currentData.getResult(totalScore);

            document.getElementById('resultTitle').textContent = result.title;
            document.getElementById('resultDesc').textContent = result.desc;
        }

        async function saveAndRedirect() {
            const token = localStorage.getItem('token');
            if (token) {
                try {
                    const response = await api.post('/quiz/result', { score: totalScore, answers: answers });

                    // Update local user if level changed or xp changed
                    const currentUser = JSON.parse(localStorage.getItem('user'));
                    if (currentUser) {
                        currentUser.level = response.level;
                        currentUser.xp = response.xp;
                        localStorage.setItem('user', JSON.stringify(currentUser));
                    }

                    if (response.message) {
                        alert(response.message);
                    } else {
                        alert(`üéâ Quiz Conclu√≠do!\n\nVoc√™ ganhou XP!\nConfira seu novo progresso no perfil.`);
                    }

                    window.location.href = 'profile.html';
                } catch (error) {
                    if (error.message && error.message.includes('429')) {
                        alert('‚ö†Ô∏è Voc√™ atingiu o limite di√°rio de Quizzes!\n\nTente novamente amanh√£ para ganhar mais XP.');
                        window.location.href = 'profile.html';
                        return;
                    }

                    if (error.response && error.response.status === 429) {
                        alert('‚ö†Ô∏è Limite di√°rio de quizzes atingido!');
                        window.location.href = 'profile.html';
                        return;
                    } else {
                        console.error('Erro ao salvar quiz:', error);
                        // Just redirect if it fails lightly, unless critical
                        window.location.href = 'services.html';
                    }
                }
            } else {
                alert('Crie uma conta para salvar seu resultado! Redirecionando para cadastro...');
                window.location.href = 'register.html';
                return;
            }
        }

        renderQuestion();
    </script>
</body>

</html>