<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tema do App - Admin</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        .has-save-bar {
            --save-bar-offset: 96px;
        }

        .has-save-bar .main {
            padding-bottom: var(--save-bar-offset);
        }

        /* Page Layout & Grid */
        .theme-page-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            align-items: flex-start;
            margin-bottom: 80px;
        }

        .theme-preview-sidebar {
            display: flex;
            flex-direction: column;
            width: 100%;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            padding: 2rem;
            border-radius: 16px;
            border: 1px dashed var(--border);
        }

        @media (min-width: 1100px) {
            .theme-page-layout {
                grid-template-columns: minmax(0, 1fr) 340px;
            }
        }

        @media (max-width: 1100px) {
            .theme-sidebar {
                position: static !important;
            }
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        /* Modern Theme Card */
        .theme-card {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            overflow: hidden;
        }

        .theme-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.08);
            border-color: var(--primary-light);
        }

        .theme-card.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--primary), 0 12px 24px -8px rgba(190, 24, 93, 0.15);
        }

        .theme-card-header {
            height: 110px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            color: #fff;
        }

        /* Gradients for Card Headers */
        .bg-gradient-nail {
            background: linear-gradient(135deg, #fce7f3 0%, #be185d 100%);
            color: #fff;
        }

        .bg-gradient-barber {
            background: linear-gradient(135deg, #1f2937 0%, #000000 100%);
            color: #f59e0b;
        }

        .bg-gradient-hair {
            background: linear-gradient(135deg, #fffbeb 0%, #d97706 100%);
            color: #fff;
        }

        .bg-gradient-spa {
            background: linear-gradient(135deg, #ecfdf5 0%, #10b981 100%);
            color: #fff;
        }

        .bg-gradient-tattoo {
            background: linear-gradient(135deg, #fca5a5 0%, #7f1d1d 100%);
            color: #fff;
        }

        .bg-gradient-health {
            background: linear-gradient(135deg, #dbeafe 0%, #2563eb 100%);
            color: #fff;
        }

        .theme-icon-large {
            font-size: 3.5rem;
            opacity: 0.9;
            transform: scale(1);
            transition: transform 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .theme-card:hover .theme-icon-large {
            transform: scale(1.1);
        }

        .theme-info h4 {
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 0.35rem;
        }

        .theme-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .theme-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            font-size: 0.7rem;
            font-weight: 600;
            color: #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Specific adjustments for legibility if needed */
        .preview-nail .theme-tag {
            color: #831843;
            background: rgba(255, 255, 255, 0.8);
        }

        .active-check {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 26px;
            height: 26px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            z-index: 2;
        }

        .theme-card.active .active-check {
            opacity: 1;
            transform: scale(1);
        }

        /* Sidebar & Phone Preview */
        .theme-sidebar {
            position: sticky;
            top: 2rem;
        }

        /* Mobile-first: phone mockup nunca deve ultrapassar viewport */
        .phone-mockup {
            width: min(90vw, 280px);
            aspect-ratio: 280 / 560;
            background: #111;
            border-radius: 40px;
            padding: clamp(6px, 2vw, 10px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.35);
            margin: 0 auto;
            position: relative;
            border: clamp(2px, 0.8vw, 4px) solid #333;
        }

        .phone-screen {
            background: #fff;
            width: 100%;
            height: 100%;
            border-radius: 30px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            transition: background 0.3s ease;
        }

        .phone-notch {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 22px;
            background: #111;
            border-bottom-left-radius: 14px;
            border-bottom-right-radius: 14px;
            z-index: 10;
        }

        /* Mockup Internal UI */
        .mockup-header {
            height: 130px;
            padding: 35px 20px 20px 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            color: white;
            transition: background 0.3s ease;
        }

        .mockup-avatar {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            margin-bottom: 12px;
        }

        .mockup-title-line {
            height: 10px;
            width: 60%;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .mockup-subtitle-line {
            height: 8px;
            width: 40%;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 4px;
        }

        .mockup-body {
            flex: 1;
            background: #fdfdfd;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .mockup-card {
            background: #fff;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 10px;
            border: 1px solid #f3f4f6;
        }

        .mockup-card-img {
            width: 42px;
            height: 42px;
            border-radius: 8px;
            background: #eee;
        }

        .mockup-card-lines {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
            justify-content: center;
        }

        .mockup-line {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            width: 100%;
        }

        .mockup-btn {
            margin-top: auto;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: #fff;
            transition: background 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Theme Variations for Phone Preview */
        /* Nail: Pink */
        .preview-theme-nail .mockup-header {
            background: #be185d;
        }

        .preview-theme-nail .mockup-btn {
            background: #be185d;
        }

        /* Barber: Dark & Gold */
        .preview-theme-barber .mockup-header {
            background: #111;
        }

        .preview-theme-barber .mockup-btn {
            background: #111;
            border: 1px solid #d4af37;
            color: #d4af37;
        }

        .preview-theme-barber .phone-screen {
            background: #1a1a1a;
        }

        .preview-theme-barber .mockup-body {
            background: #1a1a1a;
        }

        .preview-theme-barber .mockup-card {
            background: #262626;
            border-color: #333;
        }

        .preview-theme-barber .mockup-line {
            background: #404040;
        }

        .preview-theme-barber .mockup-title-line {
            background: #d4af37;
        }

        /* Hair: Gold/Orange */
        .preview-theme-hair .mockup-header {
            background: #d97706;
        }

        .preview-theme-hair .mockup-btn {
            background: #d97706;
        }

        /* Spa: Green */
        .preview-theme-spa .mockup-header {
            background: #059669;
        }

        .preview-theme-spa .mockup-btn {
            background: #059669;
        }

        /* Tattoo: Dark Red */
        .preview-theme-tattoo .mockup-header {
            background: #7f1d1d;
        }

        .preview-theme-tattoo .mockup-btn {
            background: #000;
            border: 1px solid #7f1d1d;
        }

        .preview-theme-tattoo .phone-screen {
            background: #fef2f2;
        }

        /* Slightly red tint bg? Or just white. Let's do white. */

        /* Health: Blue */
        .preview-theme-health .mockup-header {
            background: #2563eb;
        }

        .preview-theme-health .mockup-btn {
            background: #2563eb;
        }

        /* Esthetic: Purple */
        .bg-gradient-esthetic {
            background: linear-gradient(135deg, #f3e8ff 0%, #7c3aed 100%);
            color: #fff;
        }

        .preview-theme-esthetic .mockup-header {
            background: #7c3aed;
        }

        .preview-theme-esthetic .mockup-btn {
            background: #7c3aed;
        }

        /* Responsive Save Bar */
        .save-bar {
            background: var(--bg-surface);
            border-top: 1px solid var(--border);
            padding: 1.25rem 2rem;
            position: fixed;
            bottom: 0;
            left: 280px;
            right: 0;
            z-index: 40;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        @media (max-width: 768px) {
            .has-save-bar {
                --save-bar-offset: 120px;
            }

            .save-bar {
                left: 0;
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .save-bar span {
                font-size: 0.8rem;
            }

            .save-bar button {
                width: 100%;
            }

            .theme-preview-sidebar {
                padding: clamp(1rem, 5vw, 2rem);
            }
        }
    </style>
</head>

<body class="has-save-bar">
    <div class="sidebar">
        <div class="brand"><span>Admin</span>Painel</div>
        <nav class="nav-links">
            <a href="index.html" class="nav-link"><i class="ph-duotone ph-squares-four icon-dashboard"></i>
                Dashboard</a>
            <a href="financials.html" class="nav-link"><i class="ph-duotone ph-chart-line-up icon-finance"></i>
                Financeiro</a>
            <a href="users.html" class="nav-link"><i class="ph-duotone ph-users-three icon-users"></i> Clientes</a>
            <a href="appointments.html" class="nav-link"><i class="ph-duotone ph-calendar-check icon-appointments"></i>
                Agendamentos</a>
            <a href="services.html" class="nav-link"><i class="ph-duotone ph-sparkle icon-services"></i> Serviços</a>
            <a href="promotions.html" class="nav-link"><i class="ph-duotone ph-tag icon-promo"></i> Promoções</a>
            <a href="schedule-settings.html" class="nav-link"><i class="ph-duotone ph-clock icon-time"></i> Horários</a>
            <a href="notifications-admin.html" class="nav-link"><i class="ph-duotone ph-bell-ringing icon-bell"></i>
                Notificações</a>
            <a href="settings.html" class="nav-link"><i class="ph-duotone ph-trophy icon-game"></i> Gamificação</a>
            <a href="theme.html" class="nav-link active"><i class="ph-duotone ph-paint-brush icon-theme"></i>
                Aparência</a>
        </nav>
    </div>
    <div class="sidebar-overlay"></div>

    <div class="main">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 10px;">
                <button id="sidebarToggle" class="btn-icon">
                    <i class="ph-duotone ph-list"></i>
                </button>
                <div>
                    <h1>Aparência do Aplicativo</h1>
                    <p class="text-subtitle">Escolha o tema que mais combina com o seu negócio.</p>
                </div>
            </div>
        </div>

        <div class="theme-page-layout">
            <!-- Left: Theme Selection -->
            <div>
                <div style="margin-bottom: 2rem;">
                    <h3 style="font-size: 1.25rem; margin-bottom: 0.5rem;">Selecione um tema</h3>
                    <p style="color: var(--text-secondary);">
                        Isso altera as cores e o estilo visual do aplicativo que o cliente enxerga.
                        A mudança é aplicada para todos os dispositivos em poucos segundos.
                    </p>
                </div>

                <div class="theme-grid">
                    <!-- Nail Theme -->
                    <div class="theme-card active" data-theme="nail" onclick="selectTheme('nail')">
                        <div class="active-check"><i class="ph-bold ph-check"></i></div>
                        <div class="theme-card-header bg-gradient-nail">
                            <span class="theme-tag">Rosa sofisticado</span>
                            <i class="ph-duotone ph-hand-soap theme-icon-large"></i>
                        </div>
                        <div class="theme-info">
                            <h4>Esmalteria / Unhas</h4>
                            <p>Tons delicados de rosa, sensação moderna e feminina.</p>
                        </div>
                    </div>

                    <!-- Barber Theme -->
                    <div class="theme-card" data-theme="barber" onclick="selectTheme('barber')">
                        <div class="active-check"><i class="ph-bold ph-check"></i></div>
                        <div class="theme-card-header bg-gradient-barber">
                            <span class="theme-tag">Escuro premium</span>
                            <i class="ph-duotone ph-scissors theme-icon-large"></i>
                        </div>
                        <div class="theme-info">
                            <h4>Barbearia Clássica</h4>
                            <p>Preto, dourado e contraste alto, com cara de clube masculino.</p>
                        </div>
                    </div>

                    <!-- Hair Theme -->
                    <div class="theme-card" data-theme="hair" onclick="selectTheme('hair')">
                        <div class="active-check"><i class="ph-bold ph-check"></i></div>
                        <div class="theme-card-header bg-gradient-hair">
                            <span class="theme-tag">Luxo clean</span>
                            <i class="ph-duotone ph-sparkle theme-icon-large"></i>
                        </div>
                        <div class="theme-info">
                            <h4>Salão Gold</h4>
                            <p>Branco, dourado e layout iluminado para salões premium.</p>
                        </div>
                    </div>

                    <!-- Spa Theme -->
                    <div class="theme-card" data-theme="spa" onclick="selectTheme('spa')">
                        <div class="active-check"><i class="ph-bold ph-check"></i></div>
                        <div class="theme-card-header bg-gradient-spa">
                            <span class="theme-tag">Verde calma</span>
                            <i class="ph-duotone ph-plant theme-icon-large"></i>
                        </div>
                        <div class="theme-info">
                            <h4>Spa & Estética</h4>
                            <p>Paleta suave em verde água para clínicas e spas.</p>
                        </div>
                    </div>

                    <!-- Tattoo Theme -->
                    <div class="theme-card" data-theme="tattoo" onclick="selectTheme('tattoo')">
                        <div class="active-check"><i class="ph-bold ph-check"></i></div>
                        <div class="theme-card-header bg-gradient-tattoo">
                            <span class="theme-tag">Preto intenso</span>
                            <i class="ph-duotone ph-pen-nib theme-icon-large"></i>
                        </div>
                        <div class="theme-info">
                            <h4>Estúdio Tattoo</h4>
                            <p>Preto, vermelho escuro e clima de estúdio urbano.</p>
                        </div>
                    </div>

                    <!-- Health Theme -->
                    <div class="theme-card" data-theme="health" onclick="selectTheme('health')">
                        <div class="active-check"><i class="ph-bold ph-check"></i></div>
                        <div class="theme-card-header bg-gradient-health">
                            <span class="theme-tag">Azul profissional</span>
                            <i class="ph-duotone ph-heartbeat theme-icon-large"></i>
                        </div>
                        <div class="theme-info">
                            <h4>Saúde & Clínica</h4>
                            <p>Azul claro e branco, com visual mais clínico e confiável.</p>
                        </div>
                    </div>

                    <!-- Esthetic Theme -->
                    <div class="theme-card" data-theme="esthetic" onclick="selectTheme('esthetic')">
                        <div class="active-check"><i class="ph-bold ph-check"></i></div>
                        <div class="theme-card-header bg-gradient-esthetic">
                            <span class="theme-tag">Roxo sofisticado</span>
                            <i class="ph-duotone ph-sparkle theme-icon-large"></i>
                        </div>
                        <div class="theme-info">
                            <h4>Clínica de Estética</h4>
                            <p>Tons de roxo e lavanda, transmitindo luxo e transformação.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Custom Colors Section -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">

                <!-- Color Customization -->
                <div style="background: #fff; padding: 2rem; border-radius: 16px; border: 1px solid var(--border);">
                    <div style="margin-bottom: 2rem;">
                        <h3
                            style="font-size: 1.2rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 8px;">
                            <i class="ph-duotone ph-palette" style="color: var(--primary);"></i>
                            Personalizar Cores
                        </h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">
                            Deseja ajustar as cores mantendo a lógica do tema escolhido?
                        </p>
                    </div>

                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1.5rem;">
                        <!-- Primary Color -->
                        <div class="color-control">
                            <label
                                style="display: block; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9rem;">Principal</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div style="position: relative; width: 42px; height: 42px;">
                                    <input type="color" id="primaryColorInput"
                                        style="position: absolute; top:0; left:0; width: 100%; height: 100%; border: none; cursor: pointer; opacity: 0;"
                                        onchange="updatePreviewColor(this.value, 'primary')">
                                    <div id="primaryColorPreview"
                                        style="width: 100%; height: 100%; border-radius: 8px; border: 1px solid var(--border); background-color: var(--primary);">
                                    </div>
                                </div>
                                <span id="primaryColorHex"
                                    style="font-family: monospace; color: var(--text-muted); font-size: 0.85rem;">#------</span>
                            </div>
                        </div>

                        <!-- Background Color -->
                        <div class="color-control">
                            <label
                                style="display: block; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9rem;">Fundo
                                do Site</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div style="position: relative; width: 42px; height: 42px;">
                                    <input type="color" id="bgColorInput"
                                        style="position: absolute; top:0; left:0; width: 100%; height: 100%; border: none; cursor: pointer; opacity: 0;"
                                        onchange="updatePreviewColor(this.value, 'bg')">
                                    <div id="bgColorPreview"
                                        style="width: 100%; height: 100%; border-radius: 8px; border: 1px solid var(--border); background-color: #fff;">
                                    </div>
                                </div>
                                <span id="bgColorHex"
                                    style="font-family: monospace; color: var(--text-muted); font-size: 0.85rem;">Padrão</span>
                            </div>
                        </div>

                        <!-- Card Background Color -->
                        <div class="color-control">
                            <label
                                style="display: block; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9rem;">Fundo
                                dos Cards</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div style="position: relative; width: 42px; height: 42px;">
                                    <input type="color" id="bgCardColorInput"
                                        style="position: absolute; top:0; left:0; width: 100%; height: 100%; border: none; cursor: pointer; opacity: 0;"
                                        onchange="updatePreviewColor(this.value, 'bgCard')">
                                    <div id="bgCardColorPreview"
                                        style="width: 100%; height: 100%; border-radius: 8px; border: 1px solid var(--border); background-color: #fff;">
                                    </div>
                                </div>
                                <span id="bgCardColorHex"
                                    style="font-family: monospace; color: var(--text-muted); font-size: 0.85rem;">Padrão</span>
                            </div>
                        </div>

                        <!-- Text Color -->
                        <div class="color-control">
                            <label
                                style="display: block; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9rem;">Cor
                                do Texto</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div style="position: relative; width: 42px; height: 42px;">
                                    <input type="color" id="textColorInput"
                                        style="position: absolute; top:0; left:0; width: 100%; height: 100%; border: none; cursor: pointer; opacity: 0;"
                                        onchange="updatePreviewColor(this.value, 'text')">
                                    <div id="textColorPreview"
                                        style="width: 100%; height: 100%; border-radius: 8px; border: 1px solid var(--border); background-color: #000;">
                                    </div>
                                </div>
                                <span id="textColorHex"
                                    style="font-family: monospace; color: var(--text-muted); font-size: 0.85rem;">Padrão</span>
                            </div>
                        </div>

                        <!-- Radius Slider -->
                        <div class="color-control" style="grid-column: span 2;">
                            <label
                                style="display: block; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9rem;">Arredondamento
                                (Cantos)</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="range" id="radiusInput" min="0" max="40" value="12"
                                    style="flex: 1; accent-color: var(--primary);"
                                    oninput="updatePreviewColor(this.value + 'px', 'radius')">
                                <span id="radiusVal"
                                    style="font-family: monospace; color: var(--text-muted); font-size: 0.85rem; width: 40px;">12px</span>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem; display: flex; justify-content: flex-end;">
                        <button class="btn"
                            style="background: var(--bg-surface); border: 1px solid var(--border); color: var(--text);"
                            onclick="resetColors()">
                            <i class="ph-bold ph-arrow-counter-clockwise"></i> Restaurar Padrões
                        </button>
                    </div>
                </div>

                <!-- Icon Customization -->
                <div
                    style="background: #fff; padding: 2rem; border-radius: 16px; border: 1px solid var(--border); display: flex; flex-direction: column;">
                    <div style="margin-bottom: 1.5rem;">
                        <h3
                            style="font-size: 1.2rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 8px;">
                            <i class="ph-duotone ph-image" style="color: var(--primary);"></i>
                            Ícone da Notificação (PWA)
                        </h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">
                            Este ícone aparecerá nas notificações push do cliente (iPhone/Android).
                            Recomendado: 192x192px PNG transparente.
                        </p>
                    </div>

                    <div
                        style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem; border: 2px dashed var(--border); border-radius: 12px; padding: 1.5rem;">
                        <img id="iconPreview" src="/client/icons/icon-192.png" alt="Icon Preview"
                            style="width: 64px; height: 64px; border-radius: 12px; object-fit: cover; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">

                        <input type="file" id="iconInput" accept="image/*" style="display: none;"
                            onchange="uploadIcon(this)">

                        <button onclick="document.getElementById('iconInput').click()" class="btn"
                            style="background: var(--bg-surface); border: 1px solid var(--border);">
                            <i class="ph-bold ph-upload-simple"></i> Escolher Arquivo
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Right: Preview Sidebar -->
        <div class="theme-preview-sidebar theme-sidebar">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h3 style="font-size: 1.1rem; margin-bottom: 0.25rem;">Pré-visualização do aplicativo</h3>
                <p style="font-size: 0.85rem; color: var(--text-muted); padding: 0 1rem; line-height: 1.4;">
                    Use esta área para entender rapidamente como o app do cliente irá se comportar com o tema
                    escolhido.
                </p>
            </div>

            <div class="phone-mockup">
                <div class="phone-screen" id="previewScreen">
                    <div class="phone-notch"></div>
                    <div class="mockup-header">
                        <div class="mockup-avatar"></div>
                        <div class="mockup-title-line"></div>
                        <div class="mockup-subtitle-line"></div>
                    </div>
                    <div class="mockup-body">
                        <div class="mockup-card">
                            <div class="mockup-card-img"></div>
                            <div class="mockup-card-lines">
                                <div class="mockup-line" style="width: 70%;"></div>
                                <div class="mockup-line" style="width: 40%;"></div>
                            </div>
                        </div>
                        <div class="mockup-card">
                            <div class="mockup-card-img"></div>
                            <div class="mockup-card-lines">
                                <div class="mockup-line" style="width: 60%;"></div>
                                <div class="mockup-line" style="width: 50%;"></div>
                            </div>
                        </div>

                        <button class="mockup-btn">Agendar Horário</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fixed Bottom Bar -->
    <div class="save-bar">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
            <div
                style="width: 32px; height: 32px; border-radius: 50%; background: var(--info-bg); display: flex; align-items: center; justify-content: center; color: var(--info);">
                <i class="ph-duotone ph-info"></i>
            </div>
            <span class="text-subtitle" style="font-size: 0.9rem;">
                Ao salvar, o tema é sincronizado imediatamente com todos os clientes conectados.
            </span>
        </div>
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div id="statusMessage" style="display: none; font-size: 0.9rem; font-weight: 500;"></div>
            <button onclick="saveTheme()" class="btn btn-primary" style="padding: 0.75rem 2rem; font-size: 1rem;">
                <i class="ph-bold ph-floppy-disk"></i> Salvar tema do aplicativo
            </button>
        </div>
    </div>

    <script src="../client/js/api.js"></script>
    <script src="js/layout.js"></script>
    <script>
        let currentTheme = 'nail';
        let customColors = {};

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Fetch ALL Public Settings (now includes colors)
                const settings = await api.get('/settings/public');

                if (settings.client_theme) {
                    currentTheme = settings.client_theme;
                }

                if (settings.client_theme_colors) {
                    try {
                        customColors = JSON.parse(settings.client_theme_colors);
                        // Populate Inputs
                        const setInput = (id, val, hexId, previewId) => {
                            const el = document.getElementById(id);
                            if (el && val) {
                                el.value = val;
                                if (hexId) document.getElementById(hexId).textContent = val;
                                if (previewId) document.getElementById(previewId).style.backgroundColor = val;
                            }
                        };

                        setInput('primaryColorInput', customColors.primary, 'primaryColorHex', 'primaryColorPreview');
                        setInput('bgColorInput', customColors.bg, 'bgColorHex', 'bgColorPreview');
                        setInput('bgCardColorInput', customColors.bgCard, 'bgCardColorHex', 'bgCardColorPreview');
                        setInput('textColorInput', customColors.text, 'textColorHex', 'textColorPreview');

                        if (customColors.radius) {
                            const rVal = customColors.radius.replace('px', '');
                            document.getElementById('radiusInput').value = rVal;
                            document.getElementById('radiusVal').textContent = customColors.radius;
                        }

                    } catch (e) { }
                }

                if (settings.notification_icon_url) {
                    document.getElementById('iconPreview').src = settings.notification_icon_url;
                }
            } catch (e) {
                console.warn('Could not load settings', e);
            }
            // Force Update UI
            updateUI(currentTheme);
        });

        // Theme Defaults Map
        const themeDefaults = {
            nail: { primary: '#be185d', bg: '#ffffff', bgCard: '#ffffff', text: '#000000', radius: '12px' },
            barber: { primary: '#d4af37', bg: '#0B0F19', bgCard: '#111827', text: '#F3F4F6', radius: '4px' },
            hair: { primary: '#D97706', bg: '#FAFAF9', bgCard: '#ffffff', text: '#1C1917', radius: '12px' },
            spa: { primary: '#059669', bg: '#F0FDF4', bgCard: '#ffffff', text: '#064E3B', radius: '24px' },
            tattoo: { primary: '#EF4444', bg: '#050505', bgCard: '#0A0A0A', text: '#F3F4F6', radius: '4px' },
            health: { primary: '#2563EB', bg: '#F1F5F9', bgCard: '#ffffff', text: '#0F172A', radius: '12px' },
            esthetic: { primary: '#7C3AED', bg: '#F5F3FF', bgCard: '#ffffff', text: '#4C1D95', radius: '20px' }
        };

        function selectTheme(themeId) {
            currentTheme = themeId;

            // Auto-populate custom colors with theme defaults to avoid conflicts
            if (themeDefaults[themeId]) {
                // We create a copy to not mutate the default object directly if used elsewhere (though constant)
                customColors = { ...themeDefaults[themeId] };

                // Helper to safely update inputs if they exist
                const updateInput = (id, val, hexId, previewId) => {
                    const el = document.getElementById(id);
                    if (el) el.value = val;
                    const hex = document.getElementById(hexId);
                    if (hex) hex.textContent = val;
                    const prev = document.getElementById(previewId);
                    if (prev) prev.style.backgroundColor = val;
                };

                updateInput('primaryColorInput', customColors.primary, 'primaryColorHex', 'primaryColorPreview');
                updateInput('bgColorInput', customColors.bg, 'bgColorHex', 'bgColorPreview');
                updateInput('bgCardColorInput', customColors.bgCard, 'bgCardColorHex', 'bgCardColorPreview');
                updateInput('textColorInput', customColors.text, 'textColorHex', 'textColorPreview');

                // Radius
                if (customColors.radius) {
                    const rVal = customColors.radius.replace('px', '');
                    const rInput = document.getElementById('radiusInput');
                    if (rInput) rInput.value = rVal;
                    const rLabel = document.getElementById('radiusVal');
                    if (rLabel) rLabel.textContent = customColors.radius;
                }
            } else {
                customColors = {};
            }

            updateUI(themeId);
        }

        function updatePreviewColor(val, type) {
            customColors[type] = val;

            // Update Text Labels & Color Previews
            if (type === 'primary') {
                document.getElementById('primaryColorHex').textContent = val;
                document.getElementById('primaryColorPreview').style.backgroundColor = val;
            }
            if (type === 'bg') {
                document.getElementById('bgColorHex').textContent = val;
                document.getElementById('bgColorPreview').style.backgroundColor = val;
            }
            if (type === 'bgCard') {
                document.getElementById('bgCardColorHex').textContent = val;
                document.getElementById('bgCardColorPreview').style.backgroundColor = val;
            }
            if (type === 'text') {
                document.getElementById('textColorHex').textContent = val;
                document.getElementById('textColorPreview').style.backgroundColor = val;
            }
            if (type === 'radius') {
                document.getElementById('radiusVal').textContent = val;
            }

            updateUI(currentTheme);
        }

        function resetColors() {
            customColors = {};
            if (themeDefaults[currentTheme]) {
                selectTheme(currentTheme);
            } else {
                const resetInput = (id, hexId, previewId, defHex) => {
                    const el = document.getElementById(id);
                    if (el) el.value = "#000000";
                    const hex = document.getElementById(hexId);
                    if (hex) hex.textContent = "Padrão";
                    const prev = document.getElementById(previewId);
                    if (prev) prev.style.backgroundColor = defHex || 'transparent';
                };

                resetInput('primaryColorInput', 'primaryColorHex', 'primaryColorPreview', 'transparent');
                resetInput('bgColorInput', 'bgColorHex', 'bgColorPreview', 'transparent');
                resetInput('bgCardColorInput', 'bgCardColorHex', 'bgCardColorPreview', 'transparent');
                resetInput('textColorInput', 'textColorHex', 'textColorPreview', 'transparent');

                document.getElementById('radiusInput').value = 12;
                document.getElementById('radiusVal').textContent = "12px";

                updateUI(currentTheme);
            }
        }

        function updateUI(activeThemeId) {
            // Update Cards
            document.querySelectorAll('.theme-card').forEach(card => {
                if (card.dataset.theme === activeThemeId) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });

            // Update Phone Preview
            const preview = document.getElementById('previewScreen');
            if (preview) {
                // Reset Base Class
                preview.className = 'phone-screen preview-theme-' + activeThemeId;

                // Remove old inline styles first to ensure clean state if vars not present
                preview.style = '';

                // Apply Custom Colors Override
                if (customColors.primary) {
                    preview.style.setProperty('--primary', customColors.primary);

                    const header = preview.querySelector('.mockup-header');
                    const btn = preview.querySelector('.mockup-btn');
                    // Force override specifically for preview elements that might need it
                    if (activeThemeId !== 'barber' && activeThemeId !== 'tattoo') {
                        if (header) header.style.background = customColors.primary;
                        if (btn) btn.style.background = customColors.primary;
                    }
                }

                if (customColors.bg) {
                    // The preview screen background
                    preview.style.background = customColors.bg;
                }

                if (customColors.bgCard) {
                    preview.querySelectorAll('.mockup-card').forEach(c => c.style.backgroundColor = customColors.bgCard);
                }

                if (customColors.radius) {
                    preview.style.borderRadius = customColors.radius; // Phone radius? No, internal elements
                    preview.querySelectorAll('.mockup-card').forEach(c => c.style.borderRadius = customColors.radius);
                    const btn = preview.querySelector('.mockup-btn');
                    if (btn) btn.style.borderRadius = customColors.radius;
                }
            }
        }

        async function saveTheme() {
            const statusMsg = document.getElementById('statusMessage');
            try {
                statusMsg.style.display = 'block';
                statusMsg.style.color = 'var(--text-muted)';
                statusMsg.textContent = 'Salvando...';

                const payload = {
                    client_theme: currentTheme,
                    client_theme_colors: JSON.stringify(customColors)
                };

                await api.post('/admin/settings', payload);

                statusMsg.style.color = 'var(--success)';
                statusMsg.textContent = 'Tema e cores atualizados com sucesso!';

                setTimeout(() => {
                    statusMsg.style.display = 'none';
                }, 3000);
            } catch (err) {
                statusMsg.style.color = 'var(--error)';
                statusMsg.textContent = 'Erro ao salvar tema.';
                console.error(err);
            }
        }

        async function uploadIcon(input) {
            const file = input.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('icon', file);

            const statusMsg = document.getElementById('statusMessage');
            statusMsg.style.display = 'block';
            statusMsg.style.color = 'var(--text-muted)';
            statusMsg.textContent = 'Enviando ícone...';

            try {
                // Assuming we use standard fetch or update api.js to support upload
                // The 'api' helper typically strings JSON. Let's use raw fetch for multipart
                const token = localStorage.getItem('token');
                const res = await fetch('/api/admin/settings/icon', {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + token }, // No Content-Type, browser sets it for FormData
                    body: formData
                });

                if (!res.ok) {
                    const errorText = await res.text();
                    throw new Error(errorText || 'Falha no upload');
                }

                const data = await res.json();

                // Update Preview
                document.getElementById('iconPreview').src = data.url;

                statusMsg.style.color = 'var(--success)';
                statusMsg.textContent = 'Ícone atualizado!';
                setTimeout(() => statusMsg.style.display = 'none', 3000);
            } catch (e) {
                console.error(e);
                statusMsg.style.color = 'var(--error)';
                statusMsg.textContent = 'Erro: ' + e.message;
            }
        }
    </script>
</body>

</html>